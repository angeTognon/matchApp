# âœ… Section "Matchs en cours" dans le profil

## ğŸ¯ FonctionnalitÃ© ajoutÃ©e

Une nouvelle section **"Matchs en cours"** apparaÃ®t automatiquement dans votre profil quand vous avez des matchs confirmÃ©s (acceptÃ©s).

---

## ğŸ“± Interface

### Vue dans le profil

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Profil                                          â”‚
â”‚  â”œâ”€â”€ Info coach                                  â”‚
â”‚  â”œâ”€â”€ [Modifier profil] [Mes matchs]            â”‚
â”‚  â”œâ”€â”€ [ğŸ“§ Demandes de match]                     â”‚
â”‚  â”œâ”€â”€ Mes Ã©quipes                                 â”‚
â”‚  â”œâ”€â”€ Matchs rÃ©cents                              â”‚
â”‚  â”‚                                               â”‚
â”‚  â”œâ”€â”€ ğŸ†• Matchs en cours (2) â† NOUVEAU           â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   â”‚ âœ“ Match confirmÃ©               ğŸŸ¢   â”‚  â”‚
â”‚  â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚   â”‚ FC Lions vs FC Tigers                â”‚  â”‚
â”‚  â”‚   â”‚ U17 â€¢ RÃ©gional            3-1  ğŸŸ¢   â”‚  â”‚
â”‚  â”‚   â”‚ ğŸ“… 20 Oct  ğŸ• 15:00                 â”‚  â”‚
â”‚  â”‚   â”‚ ğŸ“ Stade Municipal                   â”‚  â”‚
â”‚  â”‚   â”‚ [Modifier le score]                  â”‚  â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   â”‚ âœ“ Match confirmÃ©               ğŸŸ¢   â”‚  â”‚
â”‚  â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚   â”‚ AS Monaco vs Real Madrid             â”‚  â”‚
â”‚  â”‚   â”‚ SÃ©niors â€¢ National                   â”‚  â”‚
â”‚  â”‚   â”‚ ğŸ“… 25 Oct  ğŸ• 14:30                 â”‚  â”‚
â”‚  â”‚   â”‚ ğŸ“ Complexe Sportif                 â”‚  â”‚
â”‚  â”‚   â”‚ [Ajouter le score]                  â”‚  â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”‚                                               â”‚
â”‚  â””â”€â”€ ParamÃ¨tres                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âœ¨ FonctionnalitÃ©s

### 1. **Affichage automatique**
- La section apparaÃ®t seulement si vous avez des matchs confirmÃ©s
- Badge vert avec le nombre de matchs en cours
- Design cohÃ©rent avec le reste de l'interface

### 2. **Informations complÃ¨tes**
- **Ã‰quipes** : Votre Ã©quipe vs Ã‰quipe adverse
- **CatÃ©gorie et niveau** : AffichÃ©s si disponibles
- **Date et heure** : FormatÃ©es proprement
- **Lieu** : Localisation du match
- **Score** : AffichÃ© s'il a Ã©tÃ© saisi (avec couleur selon rÃ©sultat)

### 3. **Gestion du score** ğŸ¯

#### Pour les matchs futurs :
- Pas de bouton (on attend que le match soit jouÃ©)

#### Pour les matchs passÃ©s SANS score :
- **Bouton bleu "Ajouter le score"**
- Cliquer â†’ Dialogue s'ouvre
- Saisir : Score, RÃ©sultat (Victoire/Nul/DÃ©faite), Notes
- Valider â†’ Score enregistrÃ©

#### Pour les matchs passÃ©s AVEC score :
- **Score affichÃ©** avec couleur :
  - ğŸŸ¢ Vert = Victoire
  - ğŸŸ  Orange = Match nul
  - ğŸ”´ Rouge = DÃ©faite
- **Bouton "Modifier le score"** pour corriger

---

## ğŸ”„ Dialogue d'ajout de score

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Score du match                         â”‚
â”‚                                         â”‚
â”‚  FC Lions vs FC Tigers                  â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Score (ex: 3-1, 2-2)            â”‚  â”‚
â”‚  â”‚ [  3-1  ]                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                         â”‚
â”‚  RÃ©sultat:                              â”‚
â”‚  [âœ“ Victoire] [Match nul] [DÃ©faite]   â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Notes (optionnel)               â”‚  â”‚
â”‚  â”‚ [Belle victoire malgrÃ© la       â”‚  â”‚
â”‚  â”‚  pluie. Bon match.]             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                         â”‚
â”‚  [Annuler]          [Enregistrer]      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ Fichiers crÃ©Ã©s

### Backend PHP (2 fichiers)

#### 1. **`backend/get_confirmed_matches.php`**
RÃ©cupÃ¨re tous les matchs confirmÃ©s de l'utilisateur.

**FonctionnalitÃ©s :**
- RÃ©cupÃ¨re les matchs oÃ¹ VOUS Ãªtes l'hÃ´te et qui sont confirmÃ©s
- RÃ©cupÃ¨re les matchs oÃ¹ VOUS Ãªtes l'adversaire (demande acceptÃ©e)
- UNION des deux pour avoir tous vos matchs
- DÃ©tecte si le match est passÃ© ou futur

**SQL :**
```sql
-- Matchs oÃ¹ je suis l'hÃ´te
SELECT m.*, t.name as team_name, ...
FROM amicalclub_matches m
JOIN amicalclub_teams t ON m.team_id = t.id
WHERE t.coach_id = ? AND m.result = 'confirmed'

UNION ALL

-- Matchs oÃ¹ je suis l'adversaire
SELECT m.*, my_team.name as team_name, ...
FROM amicalclub_match_requests mr
JOIN amicalclub_matches m ON mr.match_id = m.id
JOIN amicalclub_teams my_team ON mr.requesting_team_id = my_team.id
WHERE my_team.coach_id = ? AND mr.status = 'accepted' AND m.result = 'confirmed'
```

#### 2. **`backend/update_match_result.php`**
Met Ã  jour le score et le rÃ©sultat d'un match.

**ParamÃ¨tres :**
- `match_id` : ID du match
- `score` : Score (ex: "3-1")
- `result` : RÃ©sultat ('win', 'draw', 'loss')
- `notes` : Notes optionnelles

**SÃ©curitÃ© :**
- VÃ©rifie que l'utilisateur est propriÃ©taire du match
- Seul le crÃ©ateur peut ajouter le score

---

### Frontend Flutter

#### 3. **Modifications de `lib/services/api_service.dart`**

**Nouvelles mÃ©thodes :**
```dart
// RÃ©cupÃ©rer les matchs confirmÃ©s
static Future<Map<String, dynamic>> getConfirmedMatches({
  required String token,
})

// Mettre Ã  jour le rÃ©sultat d'un match
static Future<Map<String, dynamic>> updateMatchResult({
  required String token,
  required String matchId,
  required String score,
  required String result,
  String? notes,
})
```

#### 4. **Modifications de `lib/screens/profile/profile_screen.dart`**

**Nouvelles mÃ©thodes :**
- `_buildConfirmedMatchesSection()` : Construit la section complÃ¨te
- `_buildConfirmedMatchCard()` : Construit chaque carte de match
- `_getResultColor()` : Retourne la couleur selon le rÃ©sultat
- `_showAddScoreDialog()` : Affiche le dialogue pour ajouter/modifier le score

**CaractÃ©ristiques :**
- FutureBuilder pour charger les donnÃ©es de faÃ§on asynchrone
- Affichage seulement si des matchs confirmÃ©s existent
- Boutons conditionnels selon l'Ã©tat du match
- Dialogue avec ChoiceChip pour sÃ©lectionner le rÃ©sultat

---

## ğŸ¨ Design

### Carte de match confirmÃ© (sans score)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ“ Match confirmÃ©                   ğŸŸ¢  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ FC Lions vs FC Tigers                   â”‚
â”‚ U17 â€¢ RÃ©gional                          â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚ ğŸ“… 20 Oct 2025    ğŸ• 15:00             â”‚
â”‚ ğŸ“ Stade Municipal                      â”‚
â”‚                                         â”‚
â”‚ [Ajouter le score]                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Carte de match confirmÃ© (avec score)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ“ Match confirmÃ©                   ğŸŸ¢  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ FC Lions vs FC Tigers      3-1  ğŸŸ¢     â”‚
â”‚ U17 â€¢ RÃ©gional                          â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚ ğŸ“… 20 Oct 2025    ğŸ• 15:00             â”‚
â”‚ ğŸ“ Stade Municipal                      â”‚
â”‚                                         â”‚
â”‚ [Modifier le score]                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Flux de fonctionnement

### ScÃ©nario complet :

1. **CrÃ©er un match** â†’ ApparaÃ®t sur l'accueil (pending)
2. **Recevoir une demande** â†’ Badge orange "1 demande"
3. **Accepter la demande** â†’ Match passe en "confirmed"
4. **Match disparaÃ®t de l'accueil** (car plus pending)
5. **Match apparaÃ®t dans "Matchs en cours"** du profil âœ…
6. **Jouer le match** (dans la vraie vie)
7. **Retourner dans l'app**
8. **Cliquer "Ajouter le score"** âœ…
9. **Saisir** : Score (3-1), RÃ©sultat (Victoire), Notes
10. **Enregistrer** â†’ Score affichÃ© avec couleur verte âœ…
11. **Match passe en "TerminÃ©"** (result = 'win')

---

## ğŸ§ª Comment tester

### Test 1 : Voir les matchs en cours

1. Avoir au moins un match confirmÃ©
2. Aller dans l'onglet **Profil**
3. Scroller vers le bas
4. **VÃ©rifier** : Section "Matchs en cours (X)" apparaÃ®t
5. **VÃ©rifier** : Liste des matchs confirmÃ©s s'affiche

### Test 2 : Ajouter un score

1. Trouver un match passÃ© sans score
2. Cliquer sur **"Ajouter le score"**
3. **VÃ©rifier** : Dialogue s'ouvre
4. Saisir un score (ex: "3-1")
5. SÃ©lectionner un rÃ©sultat (ex: Victoire)
6. Ajouter des notes (optionnel)
7. Cliquer sur **"Enregistrer"**
8. **VÃ©rifier** : 
   - Message de succÃ¨s
   - Score affichÃ© en vert
   - Bouton change en "Modifier le score"

### Test 3 : Modifier un score

1. Trouver un match avec un score
2. Cliquer sur **"Modifier le score"**
3. Modifier les informations
4. **Enregistrer**
5. **VÃ©rifier** : Changements appliquÃ©s

---

## âš ï¸ PrÃ©requis SQL

Pour que tout fonctionne, exÃ©cutez ces deux scripts SQL :

### 1. Ajouter 'confirmed' Ã  l'ENUM
```sql
ALTER TABLE amicalclub_matches 
MODIFY COLUMN result ENUM('win', 'draw', 'loss', 'pending', 'confirmed') DEFAULT 'pending';
```
Fichier : `backend/add_confirmed_status.sql`

---

## ğŸ“Š Ã‰tats des matchs

| Ã‰tat | Valeur `result` | OÃ¹ affichÃ© | Actions disponibles |
|------|-----------------|------------|---------------------|
| CrÃ©Ã© | `pending` | Accueil | Recevoir demandes |
| ConfirmÃ© (futur) | `confirmed` | Matchs en cours | Attendre le match |
| ConfirmÃ© (passÃ©) | `confirmed` | Matchs en cours | Ajouter score |
| TerminÃ© (victoire) | `win` | Matchs rÃ©cents | Modifier score |
| TerminÃ© (nul) | `draw` | Matchs rÃ©cents | Modifier score |
| TerminÃ© (dÃ©faite) | `loss` | Matchs rÃ©cents | Modifier score |

---

## âœ… RÃ©sultat final

Maintenant dans le profil :
- âœ… **Section "Matchs en cours"** apparaÃ®t automatiquement
- âœ… **Badge vert** avec le nombre de matchs
- âœ… **Cartes dÃ©taillÃ©es** pour chaque match confirmÃ©
- âœ… **Bouton "Ajouter le score"** pour les matchs passÃ©s
- âœ… **Bouton "Modifier le score"** si score dÃ©jÃ  saisi
- âœ… **Dialogue intuitif** avec choix Victoire/Nul/DÃ©faite
- âœ… **Couleurs significatives** (vert/orange/rouge)
- âœ… **Notes optionnelles** pour chaque match

**Gestion complÃ¨te des matchs confirmÃ©s avec suivi du score !** ğŸ‰

